<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>내 프로필</title>
    <style>
        *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', 'Apple SD Gothic Neo', sans-serif}
        html{min-height:852px;background:#f8f9fa}
        body{
            width:393px;
            height:852px;
            min-height:852px;
            margin:0 auto;
            background:#fff;
            padding:28px 20px 20px;
            display:flex;
            flex-direction:column;
            -webkit-font-smoothing:antialiased;
        }

        /* header */
        .page-title{font-size:22px;font-weight:700;color:#111;margin-bottom:28px}

        /* profile */
        .profile-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
        .avatar{
            width:132px;height:132px;border-radius:50%;background:linear-gradient(180deg,#c8f179,#8bd13a);display:flex;align-items:center;justify-content:center;position:relative;border:4px solid #dffb9a;box-shadow:0 6px 20px rgba(0,0,0,0.06)
        }
        .avatar img{width:110px;height:110px;border-radius:50%;object-fit:cover}
        .edit-btn{position:absolute;right:6px;bottom:6px;width:34px;height:34px;border-radius:50%;background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,0.15);cursor:pointer}
        .name{font-weight:700;font-size:18px;margin-top:8px;display:flex;align-items:center;gap:6px}
        .name a{color:#111;text-decoration:none;font-size:16px}
        .sub{color:#8b8b8b;font-size:13px;margin-top:6px}
        .meta{color:#b3b3b3;font-size:12px;margin-top:6px}

        /* tags */
        .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;justify-content:center}
        .tag{background:#dffb9a;color:#2b2b2b;padding:8px 14px;border-radius:16px;font-size:12px}

        /* list */
        .list{margin-top:20px;border-top:1px solid #eee}
        .list-item{display:flex;justify-content:space-between;align-items:center;padding:18px 0;border-bottom:1px solid #f0f0f0}
        .list-item a{color:#222;text-decoration:none;font-size:15px;cursor:pointer}
        .chev{color:#cfcfcf;font-size:18px}

        /* bottom nav */
        .bottom-nav{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;width:330px;background:#c8f179;border-radius:30px;padding:12px 18px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
        .nav-item{display:flex;flex-direction:column;align-items:center;font-size:11px;color:#111;text-decoration:none}
        .nav-icon{width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center}

        .spacer{height:8px}
    </style>
</head>
<body>
    <div class="page-title">내 프로필</div>

    <div class="profile-wrap">
        <div class="avatar">
            <img id="profileImage" src="../assets/img/Profile_img.png" alt="avatar" onerror="this.style.background='#fff';this.style.width='76px';this.style.height='76px'">
            <div class="edit-btn" title="프로필 수정">
                <img src="../assets/img/pencil_icon.png" alt="edit" style="width:16px;height:16px;">
            </div>
        </div>
        <div class="name"><a href="#" id="userName">사용자</a></div>
        <div class="sub" id="userComment">안녕하세요</div>
        <div class="meta" id="userGradeClass">1학년 1반</div>

        <div class="tags" id="userTags">
            <!-- 키워드가 여기에 동적으로 추가됩니다 -->
        </div>
    </div>

    <div class="list" style="margin-top:28px;">
        <div class="list-item"><a href="#">내 활동</a><span class="chev">›</span></div>
        <div class="list-item"><a href="#">고객센터</a><span class="chev">›</span></div>
        <div class="list-item"><a href="#">설정</a><span class="chev">›</span></div>
        <div class="list-item"><a onclick="logout()" style="cursor:pointer">로그아웃</a><span class="chev">›</span></div>
    </div>

    <div style="flex:1"></div>

    <nav class="bottom-nav" aria-label="main navigation">
        <a class="nav-item" href="#">
            <div class="nav-icon"><img src="../assets/img/Home_icon.png" alt="home" style="width:22px;height:22px;"></div>
            <div>HOME</div>
        </a>
        <a class="nav-item" href="myPage.html">
            <div class="nav-icon"><img src="../assets/img/Profile_icon.png" alt="profile" style="width:22px;height:22px;"></div>
            <div>PROFILE</div>
        </a>
        <a class="nav-item" href="#">
            <div class="nav-icon"><img src="../assets/img/Map_icon.png" alt="map" style="width:22px;height:22px;"></div>
            <div>MAP</div>
        </a>
        <a class="nav-item" href="#">
            <div class="nav-icon"><img src="../assets/img/Chap_icon.png" alt="chat" style="width:22px;height:22px;"></div>
            <div>CHAT</div>
        </a>
    </nav>

    <script>
        // 페이지 로드 시 사용자 정보 표시
        window.addEventListener('DOMContentLoaded', async () => {
            const userStr = sessionStorage.getItem('currentUser');
            
            if (!userStr) {
                alert('로그인이 필요합니다.');
                window.location.href = 'index.html';
                return;
            }

            try {
                const user = JSON.parse(userStr);
                
                // 사용자 정보 표시
                document.getElementById('userName').textContent = user.name || '사용자';
                document.getElementById('userGradeClass').textContent = 
                    `${user.grade || ''}학년 ${user.class || ''}반`;

                // comment에서 대화 스타일과 키워드 파싱
                let chatStyle = [];
                let keywords = [];
                
                if (user.comment) {
                    try {
                        const commentData = JSON.parse(user.comment);
                        chatStyle = commentData.chatStyle || [];
                        keywords = commentData.keywords || [];
                    } catch (e) {
                        // comment가 JSON이 아닌 경우 그대로 표시
                        document.getElementById('userComment').textContent = user.comment;
                    }
                }

                // 대화 스타일 표시
                if (chatStyle.length > 0) {
                    document.getElementById('userComment').textContent = chatStyle[0];
                }

                // 키워드 표시
                const tagsContainer = document.getElementById('userTags');
                tagsContainer.innerHTML = '';
                
                if (keywords.length > 0) {
                    keywords.forEach(keyword => {
                        const tagDiv = document.createElement('div');
                        tagDiv.className = 'tag';
                        tagDiv.textContent = keyword;
                        tagsContainer.appendChild(tagDiv);
                    });
                } else {
                    // 기본 키워드 표시
                    ['#오늘급식', '#수행평가', '#시험공부'].forEach(keyword => {
                        const tagDiv = document.createElement('div');
                        tagDiv.className = 'tag';
                        tagDiv.textContent = keyword;
                        tagsContainer.appendChild(tagDiv);
                    });
                }

                // 프로필 이미지 표시 (있는 경우)
                if (user.profile_photo) {
                    document.getElementById('profileImage').src = user.profile_photo;
                }

            } catch (error) {
                console.error('사용자 정보 로드 에러:', error);
                alert('사용자 정보를 불러오는데 실패했습니다.');
                window.location.href = 'index.html';
            }
        });

        // 로그아웃 함수
        function logout() {
            if (confirm('로그아웃 하시겠습니까?')) {
                sessionStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>