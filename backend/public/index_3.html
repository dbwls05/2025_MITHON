<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>맵 & 댓글 테스트</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
section { margin-bottom: 30px; }
h2 { margin-bottom: 10px; }
input, button { margin: 5px 0; padding: 5px; }
textarea { width: 300px; height: 60px; }
.comment { border-bottom: 1px solid #ccc; padding: 5px 0; }
</style>
</head>
<body>

<h1>맵 & 댓글 테스트 페이지</h1>

<section>
<h2>맵 목록 조회</h2>
<button onclick="getMaps()">맵 목록 불러오기</button>
<ul id="mapList"></ul>
</section>

<section>
<h2>맵 선택 후 댓글 작성</h2>
<label>맵 ID: <input type="number" id="mapIdInput"></label><br>
<label>유저 ID: <input type="number" id="userIdInput"></label><br>
<textarea id="commentText" placeholder="댓글 내용"></textarea><br>
<button onclick="addComment()">댓글 작성</button>
<ul id="mapComments"></ul>
</section>

<section>
<h2>사용자별 댓글 조회</h2>
<label>유저 ID: <input type="number" id="userIdForComments"></label>
<button onclick="getUserComments()">조회</button>
<ul id="userComments"></ul>
</section>

<script>
// ============================
// 맵 목록 조회
// ============================
async function getMaps() {
  const res = await fetch('/api/maps');
  const data = await res.json();
  const ul = document.getElementById('mapList');
  ul.innerHTML = '';
  if (data.success) {
    data.data.forEach(map => {
      const li = document.createElement('li');
      li.textContent = `ID: ${map.id}, 이름: ${map.name}`;
      ul.appendChild(li);
    });
  } else {
    alert('맵 조회 실패');
  }
}

// ============================
// 댓글 작성
// ============================
async function addComment() {
  const mapId = document.getElementById('mapIdInput').value;
  const userId = document.getElementById('userIdInput').value;

  if (!mapId || !userId) {
    alert('맵 ID와 유저 ID를 입력하세요.');
    return;
  }

  try {
    const res = await fetch(`/api/maps/${mapId}/comments`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ userId })
    });
    const data = await res.json();
    if (data.success) {
      alert(`댓글 작성 완료. 댓글 ID: ${data.commentId}`);
      getMapComments(mapId);
    } else {
      alert('댓글 작성 실패: ' + data.error);
    }
  } catch (err) {
    console.error(err);
    alert('댓글 작성 중 오류 발생');
  }
}

// ============================
// 맵별 댓글 조회
// ============================
async function getMapComments(mapId) {
  const res = await fetch(`/api/maps/${mapId}/comments`);
  const data = await res.json();
  const ul = document.getElementById('mapComments');
  ul.innerHTML = '';
  if (data.success) {
    data.data.forEach(c => {
      const li = document.createElement('li');
      li.className = 'comment';
      li.textContent = `댓글 ID: ${c.id}, 사용자: ${c.name}, 프로필: ${c.profile_photo || '-'}, 맵 ID: ${c.map_id}`;
      ul.appendChild(li);
    });
  } else {
    alert('댓글 조회 실패');
  }
}

// ============================
// 사용자별 댓글 조회
// ============================
async function getUserComments() {
  const userId = document.getElementById('userIdForComments').value;
  if (!userId) { alert('유저 ID 입력'); return; }

  const res = await fetch(`/api/users/${userId}/comments`);
  const data = await res.json();
  const ul = document.getElementById('userComments');
  ul.innerHTML = '';
  if (data.success) {
    data.data.forEach(c => {
      const li = document.createElement('li');
      li.className = 'comment';
      li.textContent = `댓글 ID: ${c.id}, 맵: ${c.map_name}, 맵 ID: ${c.map_id}`;
      ul.appendChild(li);
    });
  } else {
    alert('사용자 댓글 조회 실패');
  }
}
</script>

</body>
</html>
